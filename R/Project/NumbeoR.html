<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Project Assignment NumbeoR</title>
    <meta charset="utf-8" />
    <meta name="author" content="Elvir Ibrahimovic &amp; Svetislav Bratic" />
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/default-fonts.css" rel="stylesheet" />
    <script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
    <script src="libs/plotly-binding-4.9.0/plotly.js"></script>
    <script src="libs/typedarray-0.1/typedarray.min.js"></script>
    <script src="libs/jquery-1.11.3/jquery.min.js"></script>
    <link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css-1.46.1/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main-1.46.1/plotly-latest.min.js"></script>
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Project Assignment NumbeoR
## Programming Languages for Data Science
### Elvir Ibrahimovic &amp; Svetislav Bratic
### 23 10 2019

---






# Agenda

--

- Project Description

--

- Required Libraries

--

- PostgreSQL

--

- Data Wrangling and Preparation

--

- Exploratory Data Analysis incl. Hypothesis Testing

--

- Time Series Analysis and Forecasting

--

- Dashboarding in Shiny



---
class: center, middle
# Project Description

---
## Project Goals

--

- Analysis of perceived criminality 

--

 - Analysis of Numbeo data (globally)

--

 - Hypothesis testing (Germany)
 
--

- Time Series Analysis and Forecasting of criminality in Germany

--

- Dashboarding of Numbeo data

---
## Hypothesis

&gt; The perceived criminality of people in Germany is not caused by actual criminality, but is driven by the negative news coverage of the refugee influx.

---
## Data Sources

--

**Numbeo** 

--

[Numbeo](https://www.numbeo.com) is the world’s largest database of user contributed data about cities and countries worldwide.  

Numbeo provides information on world living conditions including *cost of living*, *housing indicators*, *health care*, *traffic*, *crime* and *pollution*.  

--

**Statista**   

--

[Statista](https://de.statista.com/) is a German online portal providing statistical data collected by market and opinion research institutes and data derived from the economic sector and official statistics.  

We used it for statistical 'real' *crime rates* and number of *applications for asylum* in Germany.


---
## Architecture

.center[
&lt;img src="pics/Swimlane.PNG" width="900" height="450" /&gt;
]

---
class: center, inverse
background-image: url("pics/Github.PNG")
 
## [GitHub Repository](https://github.com/eibrahi/NumbeoR)

 
---
# Loading of Required Libraries


```r
library(tidyverse)

library(DBI)                           # for PostgreSQL
library(RPostgreSQL)                   # for PostgreSQL

library(jsonlite)                      # handling of JSON files
library(rjson)                         # handling of JSON files

library(plotly)                        # visualizations

library(corrplot)                      # visualizations of correlations
library(GGally)                        # visualizations of correlations

library(Hmisc)                         # calculation of correlations

library(fpp2)                          # forecasting/times series
library(fpp3)                          # forecasting/times series
library(tsibble)                       # tsibble object used for forecasting
```


---
class: center, middle

# Setup of PostgreSQL database

---
class: center, middle
## Technical setup of PostgreSQL

---

### Creation of a Database
A database with the name "NumbeoR" in PostgreSQL has to be created manually by the user. 

.center[
&lt;img src="pics/databaseCreationPostgreSQL.PNG" width="800" height="300" /&gt;
]

---
class: center, middle
### Establishing Connection to PostgreSQL

---
Every project member created a configFile with a personalised path to the (local) NumbeoR folder and password for PostgreSQL.

Now we are loading this configFile:

```r
# load configfile
configFile &lt;- fromJSON(file="configFile.json")
path &lt;- configFile[1]
```


Here we establish the connection to the individual PostgreSQL datatabase with the name "NumbeoR"

```r
pw = configFile[2]

# loads the PostgreSQL driver
drv &lt;- dbDriver("PostgreSQL") 

# creates a connection to the postgres database; "con" is used to connect to the database
con &lt;- dbConnect(drv, dbname = "NumbeoR",
                 host = "localhost", port = 5432,
                 user = "postgres", password = pw)

# removes the password
rm(pw)
```


---

### Creation of Tables



Six different tables need to be created:


```sql
CREATE TABLE cost_of_living (
    "Year" integer,                                   -- Year
    "Country" text,                                   -- Country
    "Cost of Living Index" numeric,                   -- Cost of Living Index
    "Rent Index" numeric,                             -- Rent Index
    "Cost of Living Plus Rent Index" numeric,   
    "Groceries Index" numeric,                   
    "Restaurant Price Index" numeric,
    "Local Purchasing Power Index" numeric
);
CREATE TABLE crime (
    "Year" integer,                                   -- Year
    "Country" text,                                   -- Country
    "Crime Index" numeric,              
    "Safety Index" numeric
);
```

---
class: middle

```sql
CREATE TABLE health_care (
    "Year" integer,                                   -- Year
    "Country" text,                                   -- Country
    "Health Care Index" numeric,              
    "Health CareExp. Index" numeric                        
);
CREATE TABLE pollution (
    "Year" integer,                                   -- Year
    "Country" text,                                   -- Country
    "Pollution Index" numeric,              
    "Exp Pollution Index" numeric                       
);
```

---
class: middle

```sql
CREATE TABLE property_investment (
    "Year" integer,                                   -- Year
    "Country" text,                                   -- Country
    "Price To Income Ratio" numeric,              
    "Gross Rental Yield City Centre" numeric,                        
    "Gross Rental Yield Outside of Centre" numeric,   
    "Price To Rent Ratio City Centre" numeric,                   
    "Price To Rent Ratio Outside Of City Centre" numeric,                  
    "Mortgage As A Percentage Of Income" numeric,                   
    "Affordability Index" numeric                      
);
CREATE TABLE traffic (
    "Year" integer,                                   -- Year
    "Country" text,                                   -- Country
    "Traffic Index" numeric,              
    "Time Index(in minutes)" numeric,                        
    "Time Exp. Index" numeric,   
    "Inefficiency Index" numeric,                   
    "CO2 Emission Index" numeric                        
);
```

---
class: center, middle
## Data Import to PostgreSQL

---
class: middle

The basic activity in the beginning of the project is to read in the JSON files containing scraped data from NumbeoR, to create dataframe and finally memorizing the data into PostgreSQL.


```r
# generate full path to the dataImport.json
pathToDataJson &lt;- paste0(path, "daten/dataImport.json")
pathToTableJson &lt;- paste0(path, "daten/tableNamesImport.json")

# reeding the dataImport and tableNames json
my_files &lt;- fromJSON(file = pathToDataJson)
my_tables &lt;- fromJSON(file= pathToTableJson)
```

---
class: middle

```r
# creating lists
my_data &lt;- list()
df_temp_my_data &lt;- list()
df_my_data &lt;- list()

for (i in 1 : length(my_files)) {
    # creating a list of JSON datafiles importing from Github
*   my_data[[i]] &lt;- fromJSON(file = my_files[i])
   
    # transform JSON files to dataframes, for each JSON file one dataframe
*   df_temp_my_data[[i]] &lt;- do.call(rbind.data.frame, my_data[[i]])
    
    # transpose dataframes to get the required structure
*   df_my_data[[i]] &lt;- as.data.frame(t(df_temp_my_data[[i]]))
    
    # Writing data into PostgreSQL
*   dbWriteTable(con, my_tables[i], value = df_my_data[[i]], append = TRUE, row.names = FALSE)
}
```


---
class: center, middle
## Data Export from PostgreSQL

---
class: center, middle
### SQL Queries

---
#### Cost of Living in Germany


```sql
SELECT * 
  FROM cost_of_living
  WHERE "Country" = 'Germany';
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; Year &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Country &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Cost of Living Index &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Rent Index &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Cost of Living Plus Rent Index &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Groceries Index &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Restaurant Price Index &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Local Purchasing Power Index &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2012 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Germany &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 88.55 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 28.94 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 67.10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 72.15 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 76.20 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 114.37 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2013 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Germany &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 91.64 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 33.24 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63.61 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 80.74 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 79.68 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 117.58 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2014 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Germany &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 87.14 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 30.29 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 59.52 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 77.86 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 77.83 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 112.28 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2015 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Germany &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 76.27 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 27.16 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 52.27 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 64.85 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 72.46 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 111.84 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2016 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Germany &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 65.54 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 24.01 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 45.58 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 53.12 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 60.68 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 147.61 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2017 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Germany &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 65.50 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25.35 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 46.26 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 50.09 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 62.62 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 124.88 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2018 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Germany &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 74.35 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 29.06 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 52.51 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 58.87 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 71.21 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 125.01 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2019 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Germany &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 67.62 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 26.85 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 48.04 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 54.27 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63.56 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 116.20 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
#### Countries with very high CO2 pollutions in 2019


```sql
SELECT "Country", "CO2 Emission Index"
  FROM traffic
  WHERE "Year"=2019 AND "CO2 Emission Index" &gt; 7500
  ORDER BY "CO2 Emission Index" DESC;
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Country &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; CO2 Emission Index &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; South Africa &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9850.16 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Egypt &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8913.49 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Lebanon &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8737.07 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Jordan &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8594.71 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; United Arab Emirates &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8457.10 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Kuwait &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8104.67 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Qatar &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7965.31 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Panama &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7826.65 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

#### Average Crime Index from 2012 - 2019


```sql
SELECT "Year", AVG("Crime Index")
  FROM crime
  GROUP BY "Year"
  ORDER BY "Year" ASC;
  
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; Year &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; avg &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2012 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 41.29760 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2013 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43.72178 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2014 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 45.35570 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2015 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 46.84585 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2016 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 45.06325 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2017 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 45.16208 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2018 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43.99652 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2019 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43.82873 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


---
class: center, middle

### Creating Master Dataframe

---
#### Data Import from PostgreSQL

Import of the different tables with the help of *dbGetQuery* function


```r
df_cost_of_living_postgres &lt;- dbGetQuery(con, "SELECT * from cost_of_living")
df_crime_postgres &lt;- dbGetQuery(con, "SELECT * from crime")
df_health_care_postgres &lt;- dbGetQuery(con, "SELECT * from health_care")
df_pollution_postgres &lt;- dbGetQuery(con, "SELECT * from pollution")
df_property_investment_postgres &lt;- dbGetQuery(con, "SELECT * from property_investment")
df_traffic_postgres &lt;- dbGetQuery(con, "SELECT * from traffic")
```

---
#### Joining Dataframes (Tables)

Joining the data to one master dataframe with a *nested full_join* function


```r
df_master &lt;- full_join(
  full_join(
    full_join(
      full_join(
        full_join(
          df_cost_of_living_postgres, df_crime_postgres, by = c("Country", "Year")),
        df_health_care_postgres, by = c("Country", "Year")), 
      df_pollution_postgres, by = c("Country", "Year")), 
    df_property_investment_postgres, by = c("Country", "Year")), 
  df_traffic_postgres, by = c("Country", "Year"))
df_master[1:6,1:4]
```

```
##   Year     Country Cost of Living Index Rent Index
## 1 2012      Norway               151.34      55.50
## 2 2012 Switzerland               141.31      58.51
## 3 2012       Japan               134.23      54.22
## 4 2012      Monaco               128.15     173.08
## 5 2012   Australia               122.96      58.85
## 6 2012     Denmark               116.52      41.31
```





---

class: center, middle

## Extend Master Dataframe with Continent 

---

Furthermore we would like to add the information in which continent the country is.

Therefore we import a table which includes a country-continent mapping.


```r
countryContinent &lt;- read.csv(file="https://raw.githubusercontent.com/eibrahi/NumbeoR/master/daten/CountryContinent.csv",header=TRUE, sep=";")
colnames(countryContinent) &lt;- c("Country", "Continent")
```

---

Checking the data types we see that the data was defined as factors


```r
glimpse(countryContinent[1:4,])
```

```
## Observations: 4
## Variables: 2
## $ Country   &lt;fct&gt; Angola, Burundi, Benin, Burkina Faso
## $ Continent &lt;fct&gt; Africa, Africa, Africa, Africa
```

Therefore we change the data types to characters 

```r
countryContinent[] &lt;- lapply(countryContinent, as.character)
```


```r
glimpse(countryContinent[1:4,])
```

```
## Observations: 4
## Variables: 2
## $ Country   &lt;chr&gt; "Angola", "Burundi", "Benin", "Burkina Faso"
## $ Continent &lt;chr&gt; "Africa", "Africa", "Africa", "Africa"
```

---

Now we can join the continents to the master dataframe with the help of a left_join function:


```r
df_master_continent &lt;- left_join(df_master,countryContinent, by="Country")
```

Checking the number of NA values within the column 'Continent' shows that there are no ones

```r
sum(is.na(df_master_continent["Continent"]))
```

```
## [1] 0
```



---
For every country one continent could be assigened.

```
## Observations: 2
## Variables: 5
## $ Year                             &lt;int&gt; 2012, 2012
## $ Country                          &lt;chr&gt; "Norway", "Switzerland"
## $ `Cost of Living Index`           &lt;dbl&gt; 151.34, 141.31
## $ `Rent Index`                     &lt;dbl&gt; 55.50, 58.51
## $ `Cost of Living Plus Rent Index` &lt;dbl&gt; 116.85, 111.51
```
[...]

```
## Observations: 2
## Variables: 4
## $ `Time Exp. Index`    &lt;dbl&gt; 18.50, 154.01
## $ `Inefficiency Index` &lt;dbl&gt; 34.94, 81.87
## $ `CO2 Emission Index` &lt;dbl&gt; 1291.33, 1577.50
## $ Continent            &lt;chr&gt; "Europe", "Europe"
```

---
class: center, middle

## Change the Column Names

---

We will change the column names so that there are no *blanks* anymore.
As example the code for changing the name of *Cost of Living* is shown.


```r
colnames(df_master_continent)[which(names(df_master_continent) ==
                        "Cost of Living Index")] &lt;- "CostOfLiving"
```




```r
glimpse(df_master_continent[1:3,1:13])
```

```
## Observations: 3
## Variables: 13
## $ Year                 &lt;int&gt; 2012, 2012, 2012
## $ Country              &lt;chr&gt; "Norway", "Switzerland", "Japan"
## $ CostOfLiving         &lt;dbl&gt; 151.34, 141.31, 134.23
## $ Rent                 &lt;dbl&gt; 55.50, 58.51, 54.22
## $ CostOfLivingPlusRent &lt;dbl&gt; 116.85, 111.51, 105.43
## $ Groceries            &lt;dbl&gt; 142.37, 130.55, 117.97
## $ RestaurantPrice      &lt;dbl&gt; 150.23, 123.11, 84.28
## $ LocalPurchasingPower &lt;dbl&gt; 92.62, 127.45, 79.94
## $ Crime                &lt;dbl&gt; 19.07, 25.78, 5.75
## $ Safety               &lt;dbl&gt; 80.93, 74.22, 94.25
## $ HealthCare           &lt;dbl&gt; 79.04, 79.51, 96.11
## $ HealthCareExp        &lt;dbl&gt; 147.12, 153.49, 179.41
## $ Pollution            &lt;dbl&gt; 19.22, 35.49, 52.50
```

---

class: center, middle

## Data Selection

---
class: middle
Selection of some variables which are to be used in some of the analyses (e.g correlation analysis), storage in an analysis dataframe.


```r
df_analysis &lt;- select(df_master_continent, Year, Country, 
    CostOfLiving, Rent, LocalPurchasingPower, 
    GrossRentalYieldCityCentre,
    GrossRentalYieldOutsideOfCentre,
    MortgageAsAPercentageOfIncome, Crime, HealthCare,
    Pollution, Traffic, Time,
    CO2Emission, Continent)
```

---

class: center, middle

# Data Understanding and Preparation

---
## General Approach

--

- Detailed inspection of data and data structure

--

- Data cleansing (e.g. outlier, NAs, NaNs)

--

- Final validation and verification of data set

---
class: center, middle

## Data Inspection

---

A summary of dataframe structure and data types can be illustrated with the glimpse function:

```r
glimpse(df_master_continent[1:3,1:15])
```

```
## Observations: 3
## Variables: 15
## $ Year                 &lt;int&gt; 2012, 2012, 2012
## $ Country              &lt;chr&gt; "Norway", "Switzerland", "Japan"
## $ CostOfLiving         &lt;dbl&gt; 151.34, 141.31, 134.23
## $ Rent                 &lt;dbl&gt; 55.50, 58.51, 54.22
## $ CostOfLivingPlusRent &lt;dbl&gt; 116.85, 111.51, 105.43
## $ Groceries            &lt;dbl&gt; 142.37, 130.55, 117.97
## $ RestaurantPrice      &lt;dbl&gt; 150.23, 123.11, 84.28
## $ LocalPurchasingPower &lt;dbl&gt; 92.62, 127.45, 79.94
## $ Crime                &lt;dbl&gt; 19.07, 25.78, 5.75
## $ Safety               &lt;dbl&gt; 80.93, 74.22, 94.25
## $ HealthCare           &lt;dbl&gt; 79.04, 79.51, 96.11
## $ HealthCareExp        &lt;dbl&gt; 147.12, 153.49, 179.41
## $ Pollution            &lt;dbl&gt; 19.22, 35.49, 52.50
## $ ExpPollution         &lt;dbl&gt; 23.23, 54.80, 74.37
## $ PriceToIncome        &lt;dbl&gt; 7.50, 6.84, 18.89
```

---
First we generate a summary of all variables:

```r
summary(df_analysis[,1:5])
```

```
##       Year        Country           CostOfLiving         Rent       
##  Min.   :2012   Length:1040        Min.   : 20.40   Min.   :  3.00  
##  1st Qu.:2014   Class :character   1st Qu.: 43.12   1st Qu.: 11.46  
##  Median :2015   Mode  :character   Median : 54.20   Median : 17.10  
##  Mean   :2016                      Mean   : 59.95   Mean   : 22.60  
##  3rd Qu.:2017                      3rd Qu.: 72.97   3rd Qu.: 29.28  
##  Max.   :2019                      Max.   :173.85   Max.   :173.08  
##                                    NA's   :139      NA's   :139     
##  LocalPurchasingPower
##  Min.   :  2.47      
##  1st Qu.: 35.55      
##  Median : 52.50      
##  Mean   : 61.86      
##  3rd Qu.: 88.47      
##  Max.   :178.74      
##  NA's   :139
```

---

```r
summary(df_analysis[,6:10])
```

```
##  GrossRentalYieldCityCentre GrossRentalYieldOutsideOfCentre
##  Min.   : 1.200             Min.   : 1.000                 
##  1st Qu.: 3.748             1st Qu.: 3.950                 
##  Median : 4.905             Median : 5.145                 
##  Mean   : 5.668             Mean   : 5.792                 
##  3rd Qu.: 6.482             3rd Qu.: 6.593                 
##  Max.   :80.310             Max.   :30.160                 
##  NA's   :212                NA's   :212                    
##  MortgageAsAPercentageOfIncome     Crime         HealthCare   
##  Min.   :  16.42               Min.   : 5.75   Min.   :16.11  
##  1st Qu.:  61.56               1st Qu.:32.98   1st Qu.:56.35  
##  Median :  98.67               Median :43.74   Median :65.83  
##  Mean   : 137.52               Mean   :44.64   Mean   :64.55  
##  3rd Qu.: 179.74               3rd Qu.:54.38   3rd Qu.:74.03  
##  Max.   :4469.07               Max.   :85.70   Max.   :96.11  
##  NA's   :212                   NA's   :97      NA's   :406
```

---


```r
summary(df_analysis[,11:15])
```

```
##    Pollution         Traffic            Time        CO2Emission      
##  Min.   :  3.24   Min.   : 18.42   Min.   :11.67   Min.   :   66.67  
##  1st Qu.: 42.37   1st Qu.: 98.89   1st Qu.:29.09   1st Qu.: 2470.76  
##  Median : 62.34   Median :124.48   Median :34.69   Median : 3705.96  
##  Mean   : 59.93   Mean   :133.60   Mean   :35.70   Mean   : 4280.98  
##  3rd Qu.: 76.29   3rd Qu.:163.39   3rd Qu.:41.62   3rd Qu.: 5763.19  
##  Max.   :149.17   Max.   :352.17   Max.   :73.50   Max.   :16403.33  
##  NA's   :196      NA's   :489      NA's   :489     NA's   :489       
##   Continent        
##  Length:1040       
##  Class :character  
##  Mode  :character  
##                    
##                    
##                    
## 
```


---
class: center, middle

## Data Cleansing

---
### Deletion of Outliers


We see that the variable Mortgage As Percentage of Income has an outlier

<<<<<<< HEAD
<div id="htmlwidget-9537ce865f2906672cd9" style="width:504px;height:504px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-9537ce865f2906672cd9">{"x":{"data":[{"orientation":"v","width":[0.0839601380819879,0.0839601380819879,0.0839601380819874,0.0839601380819879,0.0839601380819874,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879],"base":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"x":[1.17544193314783,1.25940207122981,1.3433622093118,1.42732234739379,1.51128248547578,1.59524262355776,1.67920276163975,1.76316289972174,1.84712303780373,1.93108317588572,2.0150433139677,2.09900345204969,2.18296359013168,2.26692372821367,2.35088386629565,2.43484400437764,2.51880414245963,2.60276428054162,2.6867244186236,2.77068455670559,2.85464469478758,2.93860483286957,3.02256497095155,3.10652510903354,3.19048524711553,3.27444538519752,3.3584055232795,3.44236566136149,3.52632579944348,3.61028593752547],"y":[1,3,8,8,12,43,68,84,93,71,74,66,73,71,68,38,21,7,5,10,3,0,0,0,0,0,0,0,0,1],"text":["MortgageAsAPercentageOfIncome: 1.175442<br />count:  1","MortgageAsAPercentageOfIncome: 1.259402<br />count:  3","MortgageAsAPercentageOfIncome: 1.343362<br />count:  8","MortgageAsAPercentageOfIncome: 1.427322<br />count:  8","MortgageAsAPercentageOfIncome: 1.511282<br />count: 12","MortgageAsAPercentageOfIncome: 1.595243<br />count: 43","MortgageAsAPercentageOfIncome: 1.679203<br />count: 68","MortgageAsAPercentageOfIncome: 1.763163<br />count: 84","MortgageAsAPercentageOfIncome: 1.847123<br />count: 93","MortgageAsAPercentageOfIncome: 1.931083<br />count: 71","MortgageAsAPercentageOfIncome: 2.015043<br />count: 74","MortgageAsAPercentageOfIncome: 2.099003<br />count: 66","MortgageAsAPercentageOfIncome: 2.182964<br />count: 73","MortgageAsAPercentageOfIncome: 2.266924<br />count: 71","MortgageAsAPercentageOfIncome: 2.350884<br />count: 68","MortgageAsAPercentageOfIncome: 2.434844<br />count: 38","MortgageAsAPercentageOfIncome: 2.518804<br />count: 21","MortgageAsAPercentageOfIncome: 2.602764<br />count:  7","MortgageAsAPercentageOfIncome: 2.686724<br />count:  5","MortgageAsAPercentageOfIncome: 2.770685<br />count: 10","MortgageAsAPercentageOfIncome: 2.854645<br />count:  3","MortgageAsAPercentageOfIncome: 2.938605<br />count:  0","MortgageAsAPercentageOfIncome: 3.022565<br />count:  0","MortgageAsAPercentageOfIncome: 3.106525<br />count:  0","MortgageAsAPercentageOfIncome: 3.190485<br />count:  0","MortgageAsAPercentageOfIncome: 3.274445<br />count:  0","MortgageAsAPercentageOfIncome: 3.358406<br />count:  0","MortgageAsAPercentageOfIncome: 3.442366<br />count:  0","MortgageAsAPercentageOfIncome: 3.526326<br />count:  0","MortgageAsAPercentageOfIncome: 3.610286<br />count:  1"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(89,89,89,1)","line":{"width":1.88976377952756,"color":"transparent"}},"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":23.3059360730594,"r":7.30593607305936,"b":37.2602739726027,"l":37.2602739726027},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[1.00752165698385,3.77820621368944],"tickmode":"array","ticktext":["30","100","300","1000","3000"],"tickvals":[1.47712125471966,2,2.47712125471966,3,3.47712125471966],"categoryorder":"array","categoryarray":["30","100","300","1000","3000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.65296803652968,"tickwidth":0.33208800332088,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088,"zeroline":false,"anchor":"y","title":{"text":"MortgageAsAPercentageOfIncome","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-4.65,97.65],"tickmode":"array","ticktext":["0","25","50","75"],"tickvals":[0,25,50,75],"categoryorder":"array","categoryarray":["0","25","50","75"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.65296803652968,"tickwidth":0.33208800332088,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088,"zeroline":false,"anchor":"x","title":{"text":"count","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(179,179,179,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"3d3c2ac3254c":{"x":{},"type":"bar"}},"cur_data":"3d3c2ac3254c","visdat":{"3d3c2ac3254c":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
=======
<div id="htmlwidget-e9a8c3cd0f44c4a0747d" style="width:504px;height:504px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-e9a8c3cd0f44c4a0747d">{"x":{"data":[{"orientation":"v","width":[0.0839601380819879,0.0839601380819879,0.0839601380819874,0.0839601380819879,0.0839601380819874,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879,0.0839601380819879],"base":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"x":[1.17544193314783,1.25940207122981,1.3433622093118,1.42732234739379,1.51128248547578,1.59524262355776,1.67920276163975,1.76316289972174,1.84712303780373,1.93108317588572,2.0150433139677,2.09900345204969,2.18296359013168,2.26692372821367,2.35088386629565,2.43484400437764,2.51880414245963,2.60276428054162,2.6867244186236,2.77068455670559,2.85464469478758,2.93860483286957,3.02256497095155,3.10652510903354,3.19048524711553,3.27444538519752,3.3584055232795,3.44236566136149,3.52632579944348,3.61028593752547],"y":[1,3,8,8,12,43,68,84,93,71,74,66,73,71,68,38,21,7,5,10,3,0,0,0,0,0,0,0,0,1],"text":["MortgageAsAPercentageOfIncome: 1.175442<br />count:  1","MortgageAsAPercentageOfIncome: 1.259402<br />count:  3","MortgageAsAPercentageOfIncome: 1.343362<br />count:  8","MortgageAsAPercentageOfIncome: 1.427322<br />count:  8","MortgageAsAPercentageOfIncome: 1.511282<br />count: 12","MortgageAsAPercentageOfIncome: 1.595243<br />count: 43","MortgageAsAPercentageOfIncome: 1.679203<br />count: 68","MortgageAsAPercentageOfIncome: 1.763163<br />count: 84","MortgageAsAPercentageOfIncome: 1.847123<br />count: 93","MortgageAsAPercentageOfIncome: 1.931083<br />count: 71","MortgageAsAPercentageOfIncome: 2.015043<br />count: 74","MortgageAsAPercentageOfIncome: 2.099003<br />count: 66","MortgageAsAPercentageOfIncome: 2.182964<br />count: 73","MortgageAsAPercentageOfIncome: 2.266924<br />count: 71","MortgageAsAPercentageOfIncome: 2.350884<br />count: 68","MortgageAsAPercentageOfIncome: 2.434844<br />count: 38","MortgageAsAPercentageOfIncome: 2.518804<br />count: 21","MortgageAsAPercentageOfIncome: 2.602764<br />count:  7","MortgageAsAPercentageOfIncome: 2.686724<br />count:  5","MortgageAsAPercentageOfIncome: 2.770685<br />count: 10","MortgageAsAPercentageOfIncome: 2.854645<br />count:  3","MortgageAsAPercentageOfIncome: 2.938605<br />count:  0","MortgageAsAPercentageOfIncome: 3.022565<br />count:  0","MortgageAsAPercentageOfIncome: 3.106525<br />count:  0","MortgageAsAPercentageOfIncome: 3.190485<br />count:  0","MortgageAsAPercentageOfIncome: 3.274445<br />count:  0","MortgageAsAPercentageOfIncome: 3.358406<br />count:  0","MortgageAsAPercentageOfIncome: 3.442366<br />count:  0","MortgageAsAPercentageOfIncome: 3.526326<br />count:  0","MortgageAsAPercentageOfIncome: 3.610286<br />count:  1"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(89,89,89,1)","line":{"width":1.88976377952756,"color":"transparent"}},"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":23.3059360730594,"r":7.30593607305936,"b":37.2602739726027,"l":37.2602739726027},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[1.00752165698385,3.77820621368944],"tickmode":"array","ticktext":["30","100","300","1000","3000"],"tickvals":[1.47712125471966,2,2.47712125471966,3,3.47712125471966],"categoryorder":"array","categoryarray":["30","100","300","1000","3000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.65296803652968,"tickwidth":0.33208800332088,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088,"zeroline":false,"anchor":"y","title":{"text":"MortgageAsAPercentageOfIncome","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-4.65,97.65],"tickmode":"array","ticktext":["0","25","50","75"],"tickvals":[0,25,50,75],"categoryorder":"array","categoryarray":["0","25","50","75"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.65296803652968,"tickwidth":0.33208800332088,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088,"zeroline":false,"anchor":"x","title":{"text":"count","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(179,179,179,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"51057536525":{"x":{},"type":"bar"}},"cur_data":"51057536525","visdat":{"51057536525":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
>>>>>>> 9dd6b7c3ed556377dfb8184b97f68954bcf6905d

---
Class: middle 
Deletion of outliers:

```r
df_analysis &lt;- df_analysis %&gt;% 
  mutate(MortgageAsAPercentageOfIncome = 
           ifelse(MortgageAsAPercentageOfIncome&gt;2000, 
                  NA, MortgageAsAPercentageOfIncome))

df_master_continent &lt;- df_master_continent %&gt;% 
  mutate(MortgageAsAPercentageOfIncome = 
           ifelse(MortgageAsAPercentageOfIncome&gt;2000, 
                  NA, MortgageAsAPercentageOfIncome))
```

---
class: center, middle

<<<<<<< HEAD
<div id="htmlwidget-d373e40ca954263e5e20" style="width:504px;height:504px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-d373e40ca954263e5e20">{"x":{"data":[{"orientation":"v","width":[0.0569783174238361,0.0569783174238356,0.0569783174238361,0.0569783174238356,0.0569783174238361,0.0569783174238356,0.0569783174238361,0.0569783174238356,0.0569783174238361,0.0569783174238361,0.0569783174238356,0.0569783174238356,0.0569783174238361,0.0569783174238361,0.0569783174238361,0.0569783174238356,0.0569783174238356,0.0569783174238356,0.0569783174238356,0.0569783174238365,0.0569783174238356,0.0569783174238356,0.0569783174238356,0.0569783174238356,0.0569783174238356,0.0569783174238356,0.0569783174238356,0.0569783174238365,0.0569783174238356,0.0569783174238356],"base":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"x":[1.19654466590056,1.25352298332439,1.31050130074823,1.36747961817206,1.4244579355959,1.48143625301974,1.53841457044357,1.59539288786741,1.65237120529124,1.70934952271508,1.76632784013892,1.82330615756275,1.88028447498659,1.93726279241042,1.99424110983426,2.0512194272581,2.10819774468193,2.16517606210577,2.2221543795296,2.27913269695344,2.33611101437728,2.39308933180111,2.45006764922495,2.50704596664878,2.56402428407262,2.62100260149646,2.67798091892029,2.73495923634413,2.79193755376796,2.8489158711918],"y":[1,1,5,7,6,3,13,28,42,51,59,63,55,51,53,46,44,46,43,56,55,25,28,17,7,5,3,7,4,3],"text":["MortgageAsAPercentageOfIncome: 1.196545<br />count:  1","MortgageAsAPercentageOfIncome: 1.253523<br />count:  1","MortgageAsAPercentageOfIncome: 1.310501<br />count:  5","MortgageAsAPercentageOfIncome: 1.367480<br />count:  7","MortgageAsAPercentageOfIncome: 1.424458<br />count:  6","MortgageAsAPercentageOfIncome: 1.481436<br />count:  3","MortgageAsAPercentageOfIncome: 1.538415<br />count: 13","MortgageAsAPercentageOfIncome: 1.595393<br />count: 28","MortgageAsAPercentageOfIncome: 1.652371<br />count: 42","MortgageAsAPercentageOfIncome: 1.709350<br />count: 51","MortgageAsAPercentageOfIncome: 1.766328<br />count: 59","MortgageAsAPercentageOfIncome: 1.823306<br />count: 63","MortgageAsAPercentageOfIncome: 1.880284<br />count: 55","MortgageAsAPercentageOfIncome: 1.937263<br />count: 51","MortgageAsAPercentageOfIncome: 1.994241<br />count: 53","MortgageAsAPercentageOfIncome: 2.051219<br />count: 46","MortgageAsAPercentageOfIncome: 2.108198<br />count: 44","MortgageAsAPercentageOfIncome: 2.165176<br />count: 46","MortgageAsAPercentageOfIncome: 2.222154<br />count: 43","MortgageAsAPercentageOfIncome: 2.279133<br />count: 56","MortgageAsAPercentageOfIncome: 2.336111<br />count: 55","MortgageAsAPercentageOfIncome: 2.393089<br />count: 25","MortgageAsAPercentageOfIncome: 2.450068<br />count: 28","MortgageAsAPercentageOfIncome: 2.507046<br />count: 17","MortgageAsAPercentageOfIncome: 2.564024<br />count:  7","MortgageAsAPercentageOfIncome: 2.621003<br />count:  5","MortgageAsAPercentageOfIncome: 2.677981<br />count:  3","MortgageAsAPercentageOfIncome: 2.734959<br />count:  7","MortgageAsAPercentageOfIncome: 2.791938<br />count:  4","MortgageAsAPercentageOfIncome: 2.848916<br />count:  3"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(89,89,89,1)","line":{"width":1.88976377952756,"color":"transparent"}},"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":23.3059360730594,"r":7.30593607305936,"b":37.2602739726027,"l":37.2602739726027},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[1.08258803105288,2.96287250603947],"tickmode":"array","ticktext":["30","100","300"],"tickvals":[1.47712125471966,2,2.47712125471966],"categoryorder":"array","categoryarray":["30","100","300"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.65296803652968,"tickwidth":0.33208800332088,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088,"zeroline":false,"anchor":"y","title":{"text":"MortgageAsAPercentageOfIncome","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-3.15,66.15],"tickmode":"array","ticktext":["0","20","40","60"],"tickvals":[-4.44089209850063e-016,20,40,60],"categoryorder":"array","categoryarray":["0","20","40","60"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.65296803652968,"tickwidth":0.33208800332088,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088,"zeroline":false,"anchor":"x","title":{"text":"count","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(179,179,179,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"3d3c506c416b":{"x":{},"type":"bar"}},"cur_data":"3d3c506c416b","visdat":{"3d3c506c416b":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
=======
<div id="htmlwidget-da5ee8c1fe51ce39107b" style="width:504px;height:504px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-da5ee8c1fe51ce39107b">{"x":{"data":[{"orientation":"v","width":[0.0569783174238361,0.0569783174238356,0.0569783174238361,0.0569783174238356,0.0569783174238361,0.0569783174238356,0.0569783174238361,0.0569783174238356,0.0569783174238361,0.0569783174238361,0.0569783174238356,0.0569783174238356,0.0569783174238361,0.0569783174238361,0.0569783174238361,0.0569783174238356,0.0569783174238356,0.0569783174238356,0.0569783174238356,0.0569783174238365,0.0569783174238356,0.0569783174238356,0.0569783174238356,0.0569783174238356,0.0569783174238356,0.0569783174238356,0.0569783174238356,0.0569783174238365,0.0569783174238356,0.0569783174238356],"base":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"x":[1.19654466590056,1.25352298332439,1.31050130074823,1.36747961817206,1.4244579355959,1.48143625301974,1.53841457044357,1.59539288786741,1.65237120529124,1.70934952271508,1.76632784013892,1.82330615756275,1.88028447498659,1.93726279241042,1.99424110983426,2.0512194272581,2.10819774468193,2.16517606210577,2.2221543795296,2.27913269695344,2.33611101437728,2.39308933180111,2.45006764922495,2.50704596664878,2.56402428407262,2.62100260149646,2.67798091892029,2.73495923634413,2.79193755376796,2.8489158711918],"y":[1,1,5,7,6,3,13,28,42,51,59,63,55,51,53,46,44,46,43,56,55,25,28,17,7,5,3,7,4,3],"text":["MortgageAsAPercentageOfIncome: 1.196545<br />count:  1","MortgageAsAPercentageOfIncome: 1.253523<br />count:  1","MortgageAsAPercentageOfIncome: 1.310501<br />count:  5","MortgageAsAPercentageOfIncome: 1.367480<br />count:  7","MortgageAsAPercentageOfIncome: 1.424458<br />count:  6","MortgageAsAPercentageOfIncome: 1.481436<br />count:  3","MortgageAsAPercentageOfIncome: 1.538415<br />count: 13","MortgageAsAPercentageOfIncome: 1.595393<br />count: 28","MortgageAsAPercentageOfIncome: 1.652371<br />count: 42","MortgageAsAPercentageOfIncome: 1.709350<br />count: 51","MortgageAsAPercentageOfIncome: 1.766328<br />count: 59","MortgageAsAPercentageOfIncome: 1.823306<br />count: 63","MortgageAsAPercentageOfIncome: 1.880284<br />count: 55","MortgageAsAPercentageOfIncome: 1.937263<br />count: 51","MortgageAsAPercentageOfIncome: 1.994241<br />count: 53","MortgageAsAPercentageOfIncome: 2.051219<br />count: 46","MortgageAsAPercentageOfIncome: 2.108198<br />count: 44","MortgageAsAPercentageOfIncome: 2.165176<br />count: 46","MortgageAsAPercentageOfIncome: 2.222154<br />count: 43","MortgageAsAPercentageOfIncome: 2.279133<br />count: 56","MortgageAsAPercentageOfIncome: 2.336111<br />count: 55","MortgageAsAPercentageOfIncome: 2.393089<br />count: 25","MortgageAsAPercentageOfIncome: 2.450068<br />count: 28","MortgageAsAPercentageOfIncome: 2.507046<br />count: 17","MortgageAsAPercentageOfIncome: 2.564024<br />count:  7","MortgageAsAPercentageOfIncome: 2.621003<br />count:  5","MortgageAsAPercentageOfIncome: 2.677981<br />count:  3","MortgageAsAPercentageOfIncome: 2.734959<br />count:  7","MortgageAsAPercentageOfIncome: 2.791938<br />count:  4","MortgageAsAPercentageOfIncome: 2.848916<br />count:  3"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(89,89,89,1)","line":{"width":1.88976377952756,"color":"transparent"}},"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":23.3059360730594,"r":7.30593607305936,"b":37.2602739726027,"l":37.2602739726027},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[1.08258803105288,2.96287250603947],"tickmode":"array","ticktext":["30","100","300"],"tickvals":[1.47712125471966,2,2.47712125471966],"categoryorder":"array","categoryarray":["30","100","300"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.65296803652968,"tickwidth":0.33208800332088,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088,"zeroline":false,"anchor":"y","title":{"text":"MortgageAsAPercentageOfIncome","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-3.15,66.15],"tickmode":"array","ticktext":["0","20","40","60"],"tickvals":[-4.44089209850063e-016,20,40,60],"categoryorder":"array","categoryarray":["0","20","40","60"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.65296803652968,"tickwidth":0.33208800332088,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088,"zeroline":false,"anchor":"x","title":{"text":"count","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(179,179,179,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"51038e42bc5":{"x":{},"type":"bar"}},"cur_data":"51038e42bc5","visdat":{"51038e42bc5":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
>>>>>>> 9dd6b7c3ed556377dfb8184b97f68954bcf6905d

---
### Deletion of NA Values

Sum of NA values can be ascertained as following:

```r
sum(is.na(df_analysis))
```

```
## [1] 3220
```

The observations which contain at least one NA values can be identified with the following command:


```r
df_analysis[rowSums(is.na(df_analysis)) &gt; 0,][1:4,1:5]
```

```
##    Year Country CostOfLiving   Rent LocalPurchasingPower
## 4  2012  Monaco       128.15 173.08                62.30
## 10 2012 Iceland       103.60  32.71                78.56
## 14 2012 Finland        99.69  36.47                98.14
## 15 2012 Bahrain        99.52  37.54                52.77
```

---
class: middle
All rows containing NA values can be deleted with the na.omit function:


```r
df_analysis_clean &lt;- na.omit(df_analysis)
```

Checking on how many NA values are in the new clean dataframe shows that there are none


```r
sum(is.na(df_analysis_clean))
```

```
## [1] 0
```

---
class: center, middle

# Exploratory Data Analysis (EDA)

---
## Approach and Goal

In this chapter we would like to examine the data especially with respect to the *Crime Index*.  

Here we would like to see if we can discover *correlations* between the Crime Index and other variables from Numbeo.  
 
Furthermore we would like to verify the *hypothesis* from the beginning:

&gt;"The perceived criminality of people in Germany is not caused by actual criminality, but is driven by the negative news coverage of the refugee influx."

---
class: center, middle

## Data Preparation for EDA

---
### Dataframe for 2019
For later plottings we generate a separte dataframe with 2019 data.

```r
df_analysis_clean_2019 &lt;- filter(df_analysis_clean, Year == 2019)
```

---
### Numeric Dataframe
For later correlations analysis we generate a separte dataframe with numeric variables.

```r
drops &lt;- c("Year","Country", "Continent")
df_analysis_numeric &lt;- df_analysis_clean[ , !(names( df_analysis_clean) %in% drops)]
#df_master_numeric &lt;- na.omit(df_master_numeric)
```

---
### Dataframe for Germany

For some analysis we will focus only on German data
Filter dataframe only for Germany


```r
df_Germany &lt;- filter(df_analysis_clean, Country=="Germany")
```

---

class: center, middle

## Correlations Numbeo Variables

---
### Correlation Matrix

First, a correlation matrix will be generated with the help of the corrplot package:  

![](NumbeoR_files/figure-html/unnamed-chunk-46-1.png)&lt;!-- --&gt;


---
class: middle

For the *Crime Index* we assume a correlation especially with the  
* *Rent Index*, 
* *Local Purchasing Power Index* and 
* *CO2 Emission Index*.  

This will be examined in the following.

---


### Crimes vs. Cost of Living

The function rcorr() [in Hmisc package] can be used to compute the significance levels (p-value) for pearson or spearman correlations. It returns both the correlation coefficients and the p-value of the correlation for all possible pairs of columns in the data table.

```r
corN &lt;- rcorr(as.matrix(select(df_master_continent, Crime, Rent)))
corN
```

```
##       Crime  Rent
## Crime  1.00 -0.38
## Rent  -0.38  1.00
## 
## n
##       Crime Rent
## Crime   943  849
## Rent    849  901
## 
## P
##       Crime Rent
## Crime        0  
## Rent   0
```

**Result**: No significant correlation is existing. 

see also [sthda](http://www.sthda.com/english/wiki/correlation-matrix-a-quick-start-guide-to-analyze-format-and-visualize-a-correlation-matrix-using-r-software)

---

### Crimes vs. Local Purchasing Power

Here, we show the (negative) correlation of two variables *Crime Index* and *Local Purchasing Power Index*:

```
##                      Crime LocalPurchasingPower
## Crime                 1.00                -0.42
## LocalPurchasingPower -0.42                 1.00
## 
## n
##                      Crime LocalPurchasingPower
## Crime                  943                  849
## LocalPurchasingPower   849                  901
## 
## P
##                      Crime LocalPurchasingPower
## Crime                       0                  
## LocalPurchasingPower  0
```

**Result**: No significant correlation is existing. 

---

### Crimes  vs. CO2 Emission

Here, we show the (positive) correlation of the tow variables *Crime Index* and *CO2 Emission Index*:

```
##             Crime CO2Emission
## Crime        1.00        0.46
## CO2Emission  0.46        1.00
## 
## n
##             Crime CO2Emission
## Crime         943         550
## CO2Emission   550         551
## 
## P
##             Crime CO2Emission
## Crime              0         
## CO2Emission  0
```

**Result**: No significant correlation is existing. 

---

class: center, middle

## Correlations for Hypothesis Testing

---

### Crime Index vs. Number of Refugees

Correlation of perceived crimes and the estimated number refugees in **Germany**
(number of refugees is an estimation and is derived from accumulation of number of asylum seekers from 2012 till 2019)


```r
# Importing data for number of asylum seekers per year from CSV file (data comes from statista)
asylumSeekerGer &lt;- read.csv(file="https://raw.githubusercontent.com/eibrahi/NumbeoR/master/daten/asylum_seeker_Germany.csv",header=TRUE, sep=";")
colnames(asylumSeekerGer) &lt;- c("Year", "AsylumSeekerGermany", "AsylumSeekerGermanyCum")

# Join with Dataframe for Germany
df_corCrimeAsylumGer &lt;- full_join(df_Germany,asylumSeekerGer,by="Year")
df_corCrimeAsylumGer[1:5,13:17]
```

```
##    Time CO2Emission Continent AsylumSeekerGermany AsylumSeekerGermanyCum
## 1 33.12     2238.12    Europe               77651                  77651
## 2 31.89     2008.93    Europe              127023                 204674
## 3 36.07     2826.51    Europe              202834                 407508
## 4 31.08     1914.97    Europe              476649                 884157
## 5 29.07     1574.73    Europe              745545                1629702
```

.footnote[
The historical number of asylum seekers are from: [statista](https://de.statista.com/statistik/daten/studie/76095/umfrage/asylantraege-insgesamt-in-deutschland-seit-1995/)
]

---
class: center, middle
![](NumbeoR_files/figure-html/unnamed-chunk-51-1.png)&lt;!-- --&gt;

---
class: center, middle

![](NumbeoR_files/figure-html/unnamed-chunk-52-1.png)&lt;!-- --&gt;

---
class: middle


```r
# Correlation analysis
corN &lt;- rcorr(as.matrix(select(df_corCrimeAsylumGer, Crime, AsylumSeekerGermanyCum)))
corN
```

```
##                        Crime AsylumSeekerGermanyCum
## Crime                   1.00                   0.96
## AsylumSeekerGermanyCum  0.96                   1.00
## 
## n= 8 
## 
## 
## P
##                        Crime AsylumSeekerGermanyCum
## Crime                        2e-04                 
## AsylumSeekerGermanyCum 2e-04
```

**Result**: The number of refugees in Germany is correlated with the perceived crime index. 

---
### Crime Index vs. Real Crime Rates

Correlation of perceived crimes and number of registered crime rates. 
(number of refugees estimated derived from cumulation of number of asylum seekers from 2012 till 2019)


```r
# Importing data for number of registered crimes (data comes from statista)
numberCrimesGer &lt;- read.csv(file="https://raw.githubusercontent.com/eibrahi/NumbeoR/master/daten/crimeStatisticsGermany.csv",header=TRUE, sep=";")
colnames(numberCrimesGer) &lt;- c("Year", "number_crimes")

# Join with Dataframe for Germany
df_corCrimePerRealGer &lt;- full_join(df_Germany,numberCrimesGer,by="Year")
df_corCrimePerRealGer[1:5,1:5]
```

```
##   Year Country CostOfLiving  Rent LocalPurchasingPower
## 1 2012 Germany        88.55 28.94               114.37
## 2 2013 Germany        91.64 33.24               117.58
## 3 2014 Germany        87.14 30.29               112.28
## 4 2015 Germany        76.27 27.16               111.84
## 5 2016 Germany        65.54 24.01               147.61
```

.footnote[
The historical number of registered crimes are from: [statista](https://de.statista.com/statistik/daten/studie/197/umfrage/straftaten-in-deutschland-seit-1997/)
]

---
class: center, middle
![](NumbeoR_files/figure-html/unnamed-chunk-55-1.png)&lt;!-- --&gt;

---
class: center, middle

![](NumbeoR_files/figure-html/unnamed-chunk-56-1.png)&lt;!-- --&gt;

---
class: middle

```r
# Correlation analysis
corN &lt;- rcorr(as.matrix(select(df_corCrimePerRealGer, Crime, number_crimes)))
corN
```

```
##               Crime number_crimes
## Crime          1.00         -0.29
## number_crimes -0.29          1.00
## 
## n
##               Crime number_crimes
## Crime             8             7
## number_crimes     7             7
## 
## P
##               Crime  number_crimes
## Crime                0.5263       
## number_crimes 0.5263
```

**Result**: The real crime rates seem not to influence how secure people think they are. 

---
### Conclusion Hypothesis Testing

--

The hypothesis can be confirmed. 

--

The real crime rates do not have impact on how secure people feel.  

--

However, the number of refugees correlates with the how people perceive the crime rate.  

--

The reasons behind that should be analyzed in more depth. 

--

We think that the negative reportings in the media and politics lead to this results.  

---

## Visualizations

---

### Boxplots for Crime Index

<<<<<<< HEAD
<div id="htmlwidget-2c4c10d4532c86b9ba59" style="width:504px;height:504px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-2c4c10d4532c86b9ba59">{"x":{"data":[{"x":[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,5,5,4,4,4,4,6,6,6,6,1,1],"y":[21.5,23.28,35.32,49.35,24.25,22.57,45.02,44.52,46.39,28.57,24.69,42.46,22.8,38.57,36.51,21.37,29.54,32.46,36.77,35.17,34.51,42.72,37.27,39.29,40,27.84,32.13,30.09,26.66,41.93,23.53,20.8,48.88,43.79,16.32,34.05,21.47,32.16,19.32,46.01,49.33,13.26,46.66,42.72,40.38,40.83,44.27,45.46,66.51,17.38,13.73,29.73,19.86,41.03,43.82,46.73,48.78,60.79,29.31,39.55,42.76,39.51,47.13,52.3,46.43,62.55,51.26,46.81,70.24,50.71,76.8],"hoverinfo":"y","type":"box","fillcolor":"rgba(255,255,255,1)","marker":{"opacity":null,"outliercolor":"rgba(0,0,0,1)","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)"},"size":5.66929133858268},"line":{"color":"rgba(51,51,51,1)","width":1.88976377952756},"showlegend":false,"xaxis":"x","yaxis":"y","frame":null}],"layout":{"margin":{"t":23.3059360730594,"r":7.30593607305936,"b":37.2602739726027,"l":37.2602739726027},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.4,6.6],"tickmode":"array","ticktext":["Africa","Asia","Europe","North America","Oceania","South America"],"tickvals":[1,2,3,4,5,6],"categoryorder":"array","categoryarray":["Africa","Asia","Europe","North America","Oceania","South America"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"Continent","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[10.083,79.977],"tickmode":"array","ticktext":["20","40","60"],"tickvals":[20,40,60],"categoryorder":"array","categoryarray":["20","40","60"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"Crime","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"3d3c2a367fe2":{"x":{},"y":{},"type":"box"}},"cur_data":"3d3c2a367fe2","visdat":{"3d3c2a367fe2":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
=======
<div id="htmlwidget-0476d22a91637364ef4a" style="width:504px;height:504px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-0476d22a91637364ef4a">{"x":{"data":[{"x":[21.5,23.28,35.32,49.35,24.25,22.57,45.02,44.52,46.39,28.57,24.69,42.46,22.8,38.57,36.51,21.37,29.54,32.46,36.77,35.17,34.51,42.72,37.27,39.29,40,27.84,32.13,30.09,26.66,41.93,23.53,20.8,48.88,43.79,16.32,34.05,21.47,32.16,19.32,46.01,49.33,13.26,46.66,42.72,40.38,40.83,44.27,45.46,66.51,17.38,13.73,29.73,19.86,41.03,43.82,46.73,48.78,60.79,29.31,39.55,42.76,39.51,47.13,52.3,46.43,62.55,51.26,46.81,70.24,50.71,76.8],"y":[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,5,5,4,4,4,4,6,6,6,6,1,1],"hoverinfo":"x","type":"box","fillcolor":"rgba(255,255,255,1)","marker":{"opacity":null,"outliercolor":"rgba(0,0,0,1)","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)"},"size":5.66929133858268},"line":{"color":"rgba(51,51,51,1)","width":1.88976377952756},"showlegend":false,"xaxis":"x","yaxis":"y","orientation":"h","frame":null}],"layout":{"margin":{"t":23.3059360730594,"r":7.30593607305936,"b":37.2602739726027,"l":101.552511415525},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[10.083,79.977],"tickmode":"array","ticktext":["20","40","60"],"tickvals":[20,40,60],"categoryorder":"array","categoryarray":["20","40","60"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"Crime","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.4,6.6],"tickmode":"array","ticktext":["Africa","Asia","Europe","North America","Oceania","South America"],"tickvals":[1,2,3,4,5,6],"categoryorder":"array","categoryarray":["Africa","Asia","Europe","North America","Oceania","South America"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"Continent","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"5104a2f41fd":{"x":{},"y":{},"type":"box"}},"cur_data":"5104a2f41fd","visdat":{"5104a2f41fd":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
>>>>>>> 9dd6b7c3ed556377dfb8184b97f68954bcf6905d



---
### Scatter Plot

3-dimensional scatter plot with Traffic on the x-axis, Pollution on the y-axis and the Crime Index is reflected in the bubble sizes.

<<<<<<< HEAD
<div id="htmlwidget-2a7fa9c156924072d8bb" style="width:504px;height:504px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-2a7fa9c156924072d8bb">{"x":{"data":[{"x":[196.65,236.87],"y":[56.95,86.48],"text":["Traffic: 196.65<br />Pollution: 56.95<br />Crime: 76.80<br />Continent: Africa<br />Country: South Africa","Traffic: 236.87<br />Pollution: 86.48<br />Crime: 50.71<br />Continent: Africa<br />Country: Egypt"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":[22.6771653543307,18.287603712004],"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"Africa","legendgroup":"Africa","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[134.54,137.47,145.57,150.55,154.36,112.45,147.86,176.09,176.95,90.08,199.12,135.35,178.43,159.4,165.27,105.18,193.19,221.53,195.5,196.62,233.57,109.17,116.99,201.14,163.23],"y":[37.08,66.39,54.19,57.25,32.29,63.47,66.48,87.39,53.11,53.75,80.39,67.26,72.21,63.74,81.91,87.13,62.78,79.35,69.15,74.47,57.69,74.25,72.46,75.81,75.89],"text":["Traffic: 134.54<br />Pollution: 37.08<br />Crime: 13.73<br />Continent: Asia<br />Country: Japan","Traffic: 137.47<br />Pollution: 66.39<br />Crime: 19.32<br />Continent: Asia<br />Country: Hong Kong","Traffic: 145.57<br />Pollution: 54.19<br />Crime: 34.05<br />Continent: Asia<br />Country: South Korea","Traffic: 150.55<br />Pollution: 57.25<br />Crime: 32.16<br />Continent: Asia<br />Country: Israel","Traffic: 154.36<br />Pollution: 32.29<br />Crime: 21.47<br />Continent: Asia<br />Country: Singapore","Traffic: 112.45<br />Pollution: 63.47<br />Crime: 17.38<br />Continent: Asia<br />Country: Taiwan","Traffic: 147.86<br />Pollution: 66.48<br />Crime: 13.26<br />Continent: Asia<br />Country: Qatar","Traffic: 176.09<br />Pollution: 87.39<br />Crime: 44.27<br />Continent: Asia<br />Country: Lebanon","Traffic: 176.95<br />Pollution: 53.11<br />Crime: 16.32<br />Continent: Asia<br />Country: United Arab Emirates","Traffic:  90.08<br />Pollution: 53.75<br />Crime: 29.31<br />Continent: Asia<br />Country: Cyprus","Traffic: 199.12<br />Pollution: 80.39<br />Crime: 43.82<br />Continent: Asia<br />Country: Jordan","Traffic: 135.35<br />Pollution: 67.26<br />Crime: 29.73<br />Continent: Asia<br />Country: Saudi Arabia","Traffic: 178.43<br />Pollution: 72.21<br />Crime: 46.66<br />Continent: Asia<br />Country: Thailand","Traffic: 159.40<br />Pollution: 63.74<br />Crime: 60.79<br />Continent: Asia<br />Country: Malaysia","Traffic: 165.27<br />Pollution: 81.91<br />Crime: 45.46<br />Continent: Asia<br />Country: China","Traffic: 105.18<br />Pollution: 87.13<br />Crime: 48.78<br />Continent: Asia<br />Country: Vietnam","Traffic: 193.19<br />Pollution: 62.78<br />Crime: 46.01<br />Continent: Asia<br />Country: Indonesia","Traffic: 221.53<br />Pollution: 79.35<br />Crime: 49.33<br />Continent: Asia<br />Country: Iran","Traffic: 195.50<br />Pollution: 69.15<br />Crime: 40.38<br />Continent: Asia<br />Country: Turkey","Traffic: 196.62<br />Pollution: 74.47<br />Crime: 40.83<br />Continent: Asia<br />Country: Philippines","Traffic: 233.57<br />Pollution: 57.69<br />Crime: 41.03<br />Continent: Asia<br />Country: Sri Lanka","Traffic: 109.17<br />Pollution: 74.25<br />Crime: 66.51<br />Continent: Asia<br />Country: Kazakhstan","Traffic: 116.99<br />Pollution: 72.46<br />Crime: 19.86<br />Continent: Asia<br />Country: Georgia","Traffic: 201.14<br />Pollution: 75.81<br />Crime: 42.72<br />Continent: Asia<br />Country: India","Traffic: 163.23<br />Pollution: 75.89<br />Crime: 46.73<br />Continent: Asia<br />Country: Pakistan"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(183,159,0,1)","opacity":1,"size":[5.4048249735149,9.61559400134109,14.5891658056542,14.0861132304656,10.5724318258432,8.59160406577183,3.77952755905512,16.9813777006551,7.92662871463714,13.277292867494,16.885238666532,13.400760180064,17.4806815944701,20.1238839153299,17.2323017150613,17.908819350433,17.3467069566038,18.0177897717922,16.1255982156765,16.2276054904833,16.2726747108014,21.0794326904021,9.87006872984798,16.6472085858416,17.495031576446],"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(183,159,0,1)"}},"hoveron":"points","name":"Asia","legendgroup":"Asia","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[90.28,92.95,94.54,87.1,139.08,128.21,107.4,136.15,94.01,78.08,101.79,135.37,98.09,133.25,124.32,108.12,97.65,83.54,109.89,120.01,105.79,99.6,94.93,104.58,123.85,112.3,98.58,126.84,92.76,188.73,103.55,109.79,96.09,140.7],"y":[22.03,15.24,19.86,22.14,31.12,42.7,27.45,49.89,11.93,21.97,18.01,53.75,28.01,39.43,51.86,39.36,24.33,18.15,31.58,34.96,31.03,30.84,40.96,41.89,46.47,52.38,63.98,55.39,63.47,62.8,58.86,40.97,80.85,66.63],"text":["Traffic:  90.28<br />Pollution: 22.03<br />Crime: 21.50<br />Continent: Europe<br />Country: Switzerland","Traffic:  92.95<br />Pollution: 15.24<br />Crime: 23.28<br />Continent: Europe<br />Country: Iceland","Traffic:  94.54<br />Pollution: 19.86<br />Crime: 35.32<br />Continent: Europe<br />Country: Norway","Traffic:  87.10<br />Pollution: 22.14<br />Crime: 24.25<br />Continent: Europe<br />Country: Denmark","Traffic: 139.08<br />Pollution: 31.12<br />Crime: 44.52<br />Continent: Europe<br />Country: Ireland","Traffic: 128.21<br />Pollution: 42.70<br />Crime: 46.39<br />Continent: Europe<br />Country: France","Traffic: 107.40<br />Pollution: 27.45<br />Crime: 28.57<br />Continent: Europe<br />Country: Netherlands","Traffic: 136.15<br />Pollution: 49.89<br />Crime: 42.46<br />Continent: Europe<br />Country: Belgium","Traffic:  94.01<br />Pollution: 11.93<br />Crime: 22.80<br />Continent: Europe<br />Country: Finland","Traffic:  78.08<br />Pollution: 21.97<br />Crime: 21.37<br />Continent: Europe<br />Country: Austria","Traffic: 101.79<br />Pollution: 18.01<br />Crime: 49.35<br />Continent: Europe<br />Country: Sweden","Traffic: 135.37<br />Pollution: 53.75<br />Crime: 45.02<br />Continent: Europe<br />Country: Italy","Traffic:  98.09<br />Pollution: 28.01<br />Crime: 34.51<br />Continent: Europe<br />Country: Germany","Traffic: 133.25<br />Pollution: 39.43<br />Crime: 42.72<br />Continent: Europe<br />Country: United Kingdom","Traffic: 124.32<br />Pollution: 51.86<br />Crime: 38.57<br />Continent: Europe<br />Country: Greece","Traffic: 108.12<br />Pollution: 39.36<br />Crime: 32.46<br />Continent: Europe<br />Country: Spain","Traffic:  97.65<br />Pollution: 24.33<br />Crime: 22.57<br />Continent: Europe<br />Country: Slovenia","Traffic:  83.54<br />Pollution: 18.15<br />Crime: 20.80<br />Continent: Europe<br />Country: Estonia","Traffic: 109.89<br />Pollution: 31.58<br />Crime: 32.13<br />Continent: Europe<br />Country: Portugal","Traffic: 120.01<br />Pollution: 34.96<br />Crime: 36.77<br />Continent: Europe<br />Country: Latvia","Traffic: 105.79<br />Pollution: 31.03<br />Crime: 24.69<br />Continent: Europe<br />Country: Croatia","Traffic:  99.60<br />Pollution: 30.84<br />Crime: 36.51<br />Continent: Europe<br />Country: Lithuania","Traffic:  94.93<br />Pollution: 40.96<br />Crime: 26.66<br />Continent: Europe<br />Country: Czech Republic","Traffic: 104.58<br />Pollution: 41.89<br />Crime: 29.54<br />Continent: Europe<br />Country: Slovakia","Traffic: 123.85<br />Pollution: 46.47<br />Crime: 35.17<br />Continent: Europe<br />Country: Hungary","Traffic: 112.30<br />Pollution: 52.38<br />Crime: 30.09<br />Continent: Europe<br />Country: Poland","Traffic:  98.58<br />Pollution: 63.98<br />Crime: 40.00<br />Continent: Europe<br />Country: Bulgaria","Traffic: 126.84<br />Pollution: 55.39<br />Crime: 27.84<br />Continent: Europe<br />Country: Romania","Traffic:  92.76<br />Pollution: 63.47<br />Crime: 43.79<br />Continent: Europe<br />Country: Bosnia And Herzegovina","Traffic: 188.73<br />Pollution: 62.80<br />Crime: 41.93<br />Continent: Europe<br />Country: Russia","Traffic: 103.55<br />Pollution: 58.86<br />Crime: 37.27<br />Continent: Europe<br />Country: Serbia","Traffic: 109.79<br />Pollution: 40.97<br />Crime: 23.53<br />Continent: Europe<br />Country: Belarus","Traffic:  96.09<br />Pollution: 80.85<br />Crime: 39.29<br />Continent: Europe<br />Country: Macedonia","Traffic: 140.70<br />Pollution: 66.63<br />Crime: 48.88<br />Continent: Europe<br />Country: Ukraine"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,186,56,1)","opacity":1,"size":[10.5848314180308,11.2839586881048,14.9144364936128,11.6388075627699,17.0344869751231,17.4251903053271,13.0557576150403,16.5903007194995,11.1020060197122,10.5309353821399,18.0217366221003,17.1400721977403,14.7080986746847,16.6472085858416,15.7064937477129,14.1675894839061,11.0131986189851,10.2893566754008,14.0779301520247,15.2745607626129,11.7945922267293,15.2108215502067,12.4578606406165,13.3451033210102,14.8765152496262,13.505341867917,16.0387977526091,12.831905496777,16.878804309983,16.4735061635916,15.3961532425997,11.377000068449,15.8749488461034,17.9286945772946],"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,186,56,1)"}},"hoveron":"points","name":"Europe","legendgroup":"Europe","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[149.66,140.03,166.66,175.22],"y":[33.95,27.85,62,66.02],"text":["Traffic: 149.66<br />Pollution: 33.95<br />Crime: 47.13<br />Continent: North America<br />Country: United States","Traffic: 140.03<br />Pollution: 27.85<br />Crime: 39.51<br />Continent: North America<br />Country: Canada","Traffic: 166.66<br />Pollution: 62.00<br />Crime: 46.43<br />Continent: North America<br />Country: Panama","Traffic: 175.22<br />Pollution: 66.02<br />Crime: 52.30<br />Continent: North America<br />Country: Mexico"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":[17.5767451621669,15.9259552576126,17.4334254676616,18.5923842088564],"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,191,196,1)"}},"hoveron":"points","name":"North America","legendgroup":"North America","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[129.21,146.93],"y":[22.74,23.97],"text":["Traffic: 129.21<br />Pollution: 22.74<br />Crime: 39.55<br />Continent: Oceania<br />Country: New Zealand","Traffic: 146.93<br />Pollution: 23.97<br />Crime: 42.76<br />Continent: Oceania<br />Country: Australia"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(97,156,255,1)","opacity":1,"size":[15.935206155906,16.6559413191351],"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(97,156,255,1)"}},"hoveron":"points","name":"Oceania","legendgroup":"Oceania","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[136,186.41,175.61,182.8],"y":[65.54,57.72,52.35,61.74],"text":["Traffic: 136.00<br />Pollution: 65.54<br />Crime: 46.81<br />Continent: South America<br />Country: Chile","Traffic: 186.41<br />Pollution: 57.72<br />Crime: 70.24<br />Continent: South America<br />Country: Brazil","Traffic: 175.61<br />Pollution: 52.35<br />Crime: 62.55<br />Continent: South America<br />Country: Argentina","Traffic: 182.80<br />Pollution: 61.74<br />Crime: 51.26<br />Continent: South America<br />Country: Colombia"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(245,100,227,1)","opacity":1,"size":[17.5114131935328,21.6750811632877,20.4237428455062,18.3937500143391],"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(245,100,227,1)"}},"hoveron":"points","name":"South America","legendgroup":"South America","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":23.3059360730594,"r":7.30593607305936,"b":37.2602739726027,"l":37.2602739726027},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[70.1405,244.8095],"tickmode":"array","ticktext":["100","150","200"],"tickvals":[100,150,200],"categoryorder":"array","categoryarray":["100","150","200"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"Traffic","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[8.157,91.163],"tickmode":"array","ticktext":["25","50","75"],"tickvals":[25,50,75],"categoryorder":"array","categoryarray":["25","50","75"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"Pollution","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"y":0.876265466816648},"annotations":[{"text":"Crime<br />Continent","x":1.02,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"left","yanchor":"bottom","legendTitle":true}],"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"3d3c323e5f3a":{"x":{},"y":{},"size":{},"colour":{},"points":{},"type":"scatter"}},"cur_data":"3d3c323e5f3a","visdat":{"3d3c323e5f3a":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
=======
<div id="htmlwidget-24a58c23fd5e096c2ae4" style="width:504px;height:504px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-24a58c23fd5e096c2ae4">{"x":{"data":[{"x":[196.65,236.87],"y":[56.95,86.48],"text":["Traffic: 196.65<br />Pollution: 56.95<br />Crime: 76.80<br />Continent: Africa<br />Country: South Africa","Traffic: 236.87<br />Pollution: 86.48<br />Crime: 50.71<br />Continent: Africa<br />Country: Egypt"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":[22.6771653543307,18.287603712004],"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"Africa","legendgroup":"Africa","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[134.54,137.47,145.57,150.55,154.36,112.45,147.86,176.09,176.95,90.08,199.12,135.35,178.43,159.4,165.27,105.18,193.19,221.53,195.5,196.62,233.57,109.17,116.99,201.14,163.23],"y":[37.08,66.39,54.19,57.25,32.29,63.47,66.48,87.39,53.11,53.75,80.39,67.26,72.21,63.74,81.91,87.13,62.78,79.35,69.15,74.47,57.69,74.25,72.46,75.81,75.89],"text":["Traffic: 134.54<br />Pollution: 37.08<br />Crime: 13.73<br />Continent: Asia<br />Country: Japan","Traffic: 137.47<br />Pollution: 66.39<br />Crime: 19.32<br />Continent: Asia<br />Country: Hong Kong","Traffic: 145.57<br />Pollution: 54.19<br />Crime: 34.05<br />Continent: Asia<br />Country: South Korea","Traffic: 150.55<br />Pollution: 57.25<br />Crime: 32.16<br />Continent: Asia<br />Country: Israel","Traffic: 154.36<br />Pollution: 32.29<br />Crime: 21.47<br />Continent: Asia<br />Country: Singapore","Traffic: 112.45<br />Pollution: 63.47<br />Crime: 17.38<br />Continent: Asia<br />Country: Taiwan","Traffic: 147.86<br />Pollution: 66.48<br />Crime: 13.26<br />Continent: Asia<br />Country: Qatar","Traffic: 176.09<br />Pollution: 87.39<br />Crime: 44.27<br />Continent: Asia<br />Country: Lebanon","Traffic: 176.95<br />Pollution: 53.11<br />Crime: 16.32<br />Continent: Asia<br />Country: United Arab Emirates","Traffic:  90.08<br />Pollution: 53.75<br />Crime: 29.31<br />Continent: Asia<br />Country: Cyprus","Traffic: 199.12<br />Pollution: 80.39<br />Crime: 43.82<br />Continent: Asia<br />Country: Jordan","Traffic: 135.35<br />Pollution: 67.26<br />Crime: 29.73<br />Continent: Asia<br />Country: Saudi Arabia","Traffic: 178.43<br />Pollution: 72.21<br />Crime: 46.66<br />Continent: Asia<br />Country: Thailand","Traffic: 159.40<br />Pollution: 63.74<br />Crime: 60.79<br />Continent: Asia<br />Country: Malaysia","Traffic: 165.27<br />Pollution: 81.91<br />Crime: 45.46<br />Continent: Asia<br />Country: China","Traffic: 105.18<br />Pollution: 87.13<br />Crime: 48.78<br />Continent: Asia<br />Country: Vietnam","Traffic: 193.19<br />Pollution: 62.78<br />Crime: 46.01<br />Continent: Asia<br />Country: Indonesia","Traffic: 221.53<br />Pollution: 79.35<br />Crime: 49.33<br />Continent: Asia<br />Country: Iran","Traffic: 195.50<br />Pollution: 69.15<br />Crime: 40.38<br />Continent: Asia<br />Country: Turkey","Traffic: 196.62<br />Pollution: 74.47<br />Crime: 40.83<br />Continent: Asia<br />Country: Philippines","Traffic: 233.57<br />Pollution: 57.69<br />Crime: 41.03<br />Continent: Asia<br />Country: Sri Lanka","Traffic: 109.17<br />Pollution: 74.25<br />Crime: 66.51<br />Continent: Asia<br />Country: Kazakhstan","Traffic: 116.99<br />Pollution: 72.46<br />Crime: 19.86<br />Continent: Asia<br />Country: Georgia","Traffic: 201.14<br />Pollution: 75.81<br />Crime: 42.72<br />Continent: Asia<br />Country: India","Traffic: 163.23<br />Pollution: 75.89<br />Crime: 46.73<br />Continent: Asia<br />Country: Pakistan"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(183,159,0,1)","opacity":1,"size":[5.4048249735149,9.61559400134109,14.5891658056542,14.0861132304656,10.5724318258432,8.59160406577183,3.77952755905512,16.9813777006551,7.92662871463714,13.277292867494,16.885238666532,13.400760180064,17.4806815944701,20.1238839153299,17.2323017150613,17.908819350433,17.3467069566038,18.0177897717922,16.1255982156765,16.2276054904833,16.2726747108014,21.0794326904021,9.87006872984798,16.6472085858416,17.495031576446],"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(183,159,0,1)"}},"hoveron":"points","name":"Asia","legendgroup":"Asia","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[90.28,92.95,94.54,87.1,139.08,128.21,107.4,136.15,94.01,78.08,101.79,135.37,98.09,133.25,124.32,108.12,97.65,83.54,109.89,120.01,105.79,99.6,94.93,104.58,123.85,112.3,98.58,126.84,92.76,188.73,103.55,109.79,96.09,140.7],"y":[22.03,15.24,19.86,22.14,31.12,42.7,27.45,49.89,11.93,21.97,18.01,53.75,28.01,39.43,51.86,39.36,24.33,18.15,31.58,34.96,31.03,30.84,40.96,41.89,46.47,52.38,63.98,55.39,63.47,62.8,58.86,40.97,80.85,66.63],"text":["Traffic:  90.28<br />Pollution: 22.03<br />Crime: 21.50<br />Continent: Europe<br />Country: Switzerland","Traffic:  92.95<br />Pollution: 15.24<br />Crime: 23.28<br />Continent: Europe<br />Country: Iceland","Traffic:  94.54<br />Pollution: 19.86<br />Crime: 35.32<br />Continent: Europe<br />Country: Norway","Traffic:  87.10<br />Pollution: 22.14<br />Crime: 24.25<br />Continent: Europe<br />Country: Denmark","Traffic: 139.08<br />Pollution: 31.12<br />Crime: 44.52<br />Continent: Europe<br />Country: Ireland","Traffic: 128.21<br />Pollution: 42.70<br />Crime: 46.39<br />Continent: Europe<br />Country: France","Traffic: 107.40<br />Pollution: 27.45<br />Crime: 28.57<br />Continent: Europe<br />Country: Netherlands","Traffic: 136.15<br />Pollution: 49.89<br />Crime: 42.46<br />Continent: Europe<br />Country: Belgium","Traffic:  94.01<br />Pollution: 11.93<br />Crime: 22.80<br />Continent: Europe<br />Country: Finland","Traffic:  78.08<br />Pollution: 21.97<br />Crime: 21.37<br />Continent: Europe<br />Country: Austria","Traffic: 101.79<br />Pollution: 18.01<br />Crime: 49.35<br />Continent: Europe<br />Country: Sweden","Traffic: 135.37<br />Pollution: 53.75<br />Crime: 45.02<br />Continent: Europe<br />Country: Italy","Traffic:  98.09<br />Pollution: 28.01<br />Crime: 34.51<br />Continent: Europe<br />Country: Germany","Traffic: 133.25<br />Pollution: 39.43<br />Crime: 42.72<br />Continent: Europe<br />Country: United Kingdom","Traffic: 124.32<br />Pollution: 51.86<br />Crime: 38.57<br />Continent: Europe<br />Country: Greece","Traffic: 108.12<br />Pollution: 39.36<br />Crime: 32.46<br />Continent: Europe<br />Country: Spain","Traffic:  97.65<br />Pollution: 24.33<br />Crime: 22.57<br />Continent: Europe<br />Country: Slovenia","Traffic:  83.54<br />Pollution: 18.15<br />Crime: 20.80<br />Continent: Europe<br />Country: Estonia","Traffic: 109.89<br />Pollution: 31.58<br />Crime: 32.13<br />Continent: Europe<br />Country: Portugal","Traffic: 120.01<br />Pollution: 34.96<br />Crime: 36.77<br />Continent: Europe<br />Country: Latvia","Traffic: 105.79<br />Pollution: 31.03<br />Crime: 24.69<br />Continent: Europe<br />Country: Croatia","Traffic:  99.60<br />Pollution: 30.84<br />Crime: 36.51<br />Continent: Europe<br />Country: Lithuania","Traffic:  94.93<br />Pollution: 40.96<br />Crime: 26.66<br />Continent: Europe<br />Country: Czech Republic","Traffic: 104.58<br />Pollution: 41.89<br />Crime: 29.54<br />Continent: Europe<br />Country: Slovakia","Traffic: 123.85<br />Pollution: 46.47<br />Crime: 35.17<br />Continent: Europe<br />Country: Hungary","Traffic: 112.30<br />Pollution: 52.38<br />Crime: 30.09<br />Continent: Europe<br />Country: Poland","Traffic:  98.58<br />Pollution: 63.98<br />Crime: 40.00<br />Continent: Europe<br />Country: Bulgaria","Traffic: 126.84<br />Pollution: 55.39<br />Crime: 27.84<br />Continent: Europe<br />Country: Romania","Traffic:  92.76<br />Pollution: 63.47<br />Crime: 43.79<br />Continent: Europe<br />Country: Bosnia And Herzegovina","Traffic: 188.73<br />Pollution: 62.80<br />Crime: 41.93<br />Continent: Europe<br />Country: Russia","Traffic: 103.55<br />Pollution: 58.86<br />Crime: 37.27<br />Continent: Europe<br />Country: Serbia","Traffic: 109.79<br />Pollution: 40.97<br />Crime: 23.53<br />Continent: Europe<br />Country: Belarus","Traffic:  96.09<br />Pollution: 80.85<br />Crime: 39.29<br />Continent: Europe<br />Country: Macedonia","Traffic: 140.70<br />Pollution: 66.63<br />Crime: 48.88<br />Continent: Europe<br />Country: Ukraine"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,186,56,1)","opacity":1,"size":[10.5848314180308,11.2839586881048,14.9144364936128,11.6388075627699,17.0344869751231,17.4251903053271,13.0557576150403,16.5903007194995,11.1020060197122,10.5309353821399,18.0217366221003,17.1400721977403,14.7080986746847,16.6472085858416,15.7064937477129,14.1675894839061,11.0131986189851,10.2893566754008,14.0779301520247,15.2745607626129,11.7945922267293,15.2108215502067,12.4578606406165,13.3451033210102,14.8765152496262,13.505341867917,16.0387977526091,12.831905496777,16.878804309983,16.4735061635916,15.3961532425997,11.377000068449,15.8749488461034,17.9286945772946],"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,186,56,1)"}},"hoveron":"points","name":"Europe","legendgroup":"Europe","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[149.66,140.03,166.66,175.22],"y":[33.95,27.85,62,66.02],"text":["Traffic: 149.66<br />Pollution: 33.95<br />Crime: 47.13<br />Continent: North America<br />Country: United States","Traffic: 140.03<br />Pollution: 27.85<br />Crime: 39.51<br />Continent: North America<br />Country: Canada","Traffic: 166.66<br />Pollution: 62.00<br />Crime: 46.43<br />Continent: North America<br />Country: Panama","Traffic: 175.22<br />Pollution: 66.02<br />Crime: 52.30<br />Continent: North America<br />Country: Mexico"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":[17.5767451621669,15.9259552576126,17.4334254676616,18.5923842088564],"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,191,196,1)"}},"hoveron":"points","name":"North America","legendgroup":"North America","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[129.21,146.93],"y":[22.74,23.97],"text":["Traffic: 129.21<br />Pollution: 22.74<br />Crime: 39.55<br />Continent: Oceania<br />Country: New Zealand","Traffic: 146.93<br />Pollution: 23.97<br />Crime: 42.76<br />Continent: Oceania<br />Country: Australia"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(97,156,255,1)","opacity":1,"size":[15.935206155906,16.6559413191351],"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(97,156,255,1)"}},"hoveron":"points","name":"Oceania","legendgroup":"Oceania","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[136,186.41,175.61,182.8],"y":[65.54,57.72,52.35,61.74],"text":["Traffic: 136.00<br />Pollution: 65.54<br />Crime: 46.81<br />Continent: South America<br />Country: Chile","Traffic: 186.41<br />Pollution: 57.72<br />Crime: 70.24<br />Continent: South America<br />Country: Brazil","Traffic: 175.61<br />Pollution: 52.35<br />Crime: 62.55<br />Continent: South America<br />Country: Argentina","Traffic: 182.80<br />Pollution: 61.74<br />Crime: 51.26<br />Continent: South America<br />Country: Colombia"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(245,100,227,1)","opacity":1,"size":[17.5114131935328,21.6750811632877,20.4237428455062,18.3937500143391],"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(245,100,227,1)"}},"hoveron":"points","name":"South America","legendgroup":"South America","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":23.3059360730594,"r":7.30593607305936,"b":37.2602739726027,"l":37.2602739726027},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[70.1405,244.8095],"tickmode":"array","ticktext":["100","150","200"],"tickvals":[100,150,200],"categoryorder":"array","categoryarray":["100","150","200"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"Traffic","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[8.157,91.163],"tickmode":"array","ticktext":["25","50","75"],"tickvals":[25,50,75],"categoryorder":"array","categoryarray":["25","50","75"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"Pollution","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"y":0.876265466816648},"annotations":[{"text":"Crime<br />Continent","x":1.02,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"left","yanchor":"bottom","legendTitle":true}],"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"5106d635b15":{"x":{},"y":{},"size":{},"colour":{},"points":{},"type":"scatter"}},"cur_data":"5106d635b15","visdat":{"5106d635b15":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
>>>>>>> 9dd6b7c3ed556377dfb8184b97f68954bcf6905d


---
class: center, middle

# Forecasting / Times Series Analysis


---

## General 

What? 
We are going to analyse the **Crime Rate**.

What for?
We are analyizing the crime rate for **Germany**?

For which time horizon?
We are analyizing the crime rate for Germany for the years **2012 until 2019**?


.footnote[
Note:
This chapter is in general according to [Forecasting: Principles and Practice - February 2019](https://otexts.com/fpp3/) and [Forecasting: Principles and Practice - April 2018](https://otexts.com/fpp2/) by Rob J Hyndman and George Athanasopoulos 
]

---
class: center, middle

## Data Preparation

---
### Preparation Dataframe


There are diffrent objects that are be used in the forecasting fpp package:
* tsibbles
* vectors -&gt; timeseries

---

### Data Transformation into Tsibble

A time series can be thought of as a list of numbers (the measurements), along with some information about what times those numbers were recorded (the index). This information can be stored as a tsibble object in R.


```r
tsibble_Germany &lt;- as_tsibble(df_Germany, index=Year)
```


```
## [1] "tbl_ts"     "tbl_df"     "tbl"        "data.frame"
```


```
## # A tsibble: 8 x 5 [1Y]
##    Year Country CostOfLiving  Rent LocalPurchasingPower
##   &lt;int&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;
## 1  2012 Germany         88.6  28.9                 114.
## 2  2013 Germany         91.6  33.2                 118.
## 3  2014 Germany         87.1  30.3                 112.
## 4  2015 Germany         76.3  27.2                 112.
## 5  2016 Germany         65.5  24.0                 148.
## 6  2017 Germany         65.5  25.4                 125.
## 7  2018 Germany         74.4  29.1                 125.
## 8  2019 Germany         67.6  26.8                 116.
```



---
### Data Transformation into Vectors and Time Series   

In order to be able to work with the partial data sets later, we split the respective dataframe into individual vectors for different indexes.



```r
crimeGermanyVector &lt;- df_Germany[,9]
costOfLivingVector &lt;- df_Germany[,3]
healthCareVector &lt;- df_Germany[,11]
pollutionVector &lt;- df_Germany[,13]
crimeGermanyVector
```

```
## [1] 21.20 23.86 27.14 28.49 32.95 32.03 36.65 34.51
```




---

Now we convert the vectors into times series.

```r
crimeGermanyTS &lt;- ts(crimeGermanyVector, start=2012, end=2019, frequency=1)
costOfLivingGermanyTS &lt;- ts(costOfLivingVector, start=2012, end=2019, frequency=1)
healthCareGermanyTS &lt;- ts(healthCareVector, start=2012, end=2019, frequency=1)
pollutionGermanyTS &lt;- ts(pollutionVector, start=2012, end=2019, frequency=1)
crimeGermanyTS
```

```
## Time Series:
## Start = 2012 
## End = 2019 
## Frequency = 1 
## [1] 21.20 23.86 27.14 28.49 32.95 32.03 36.65 34.51
```

```r
class(crimeGermanyTS)
```

```
## [1] "ts"
```


---
class: center, middle

## Model Choice

---
There are many different models to analyize times series. 

How do we chose the right model?
* *Visual inspection*: is there seasonality or trend?
* Is decomposition technique *additive* or *multiplicative*? (Log tranformation if required)
* Chosing the appropriate model, e.g. 

Model                                  |   Seasonal?  |    Trend?    | Correlations?
---------------------------------------|--------------|--------------|--------------
Simple Moving Average Smoothing        |      no      |     yes      |      no 
Seasonal Adjustments                   |      yes     |     yes      |      no 
Simple Exponential Smoothing           |      no      |     yes/no   |      no 
Holts Exponential Smoothing            |      no      |     yes      |      no 
Holt-Winters Exponential Smoothing     |      yes     |     yes      |      no 
ARIMA                                  |      yes     |     yes      |      yes 

* Testing of the model
* Verification of the model performance

.footnote[
According to [Data Science - Part X - Time Series Forecasting](https://www.youtube.com/watch?v=msFkHl7P28k&amp;t=1922s) by Derek Kane
]

---


### Visual Inspection

---

#### Crime Index Germany

![](NumbeoR_files/figure-html/unnamed-chunk-66-1.png)&lt;!-- --&gt;

---
#### Overall overview 
![](NumbeoR_files/figure-html/unnamed-chunk-67-1.png)&lt;!-- --&gt;

---

#### Correlations

![](NumbeoR_files/figure-html/unnamed-chunk-68-1.png)&lt;!-- --&gt;


---



#### Conclusion

As there are no significant correlations and no seasonal components, models like 
* Simple forecasting methods
* Simple Moving Average Smoothing
* Simple Exponential Smoothing
* Holts Exponential Smoothing  

can be used.

---
class: center, middle

## Modelling

---
class: center, middle
### Some simple forecasting methods

---

#### Average method

The forecasted values are equal to the average (or **“mean”**) of the historical data. 
h is the time horizon for the forecast.

```
##      Point Forecast    Lo 80    Hi 80    Lo 95    Hi 95
## 2020       29.60375 21.54728 37.66022 16.13976 43.06774
## 2021       29.60375 21.54728 37.66022 16.13976 43.06774
## 2022       29.60375 21.54728 37.66022 16.13976 43.06774
```


---

#### Naïve method (random walk forecasts)

The **last value** of the historical data is set as predicted value. 
h is the time horizon for the forecast.

```
##      Point Forecast    Lo 80    Hi 80    Lo 95    Hi 95
## 2020          34.51 30.56539 38.45461 28.47723 40.54277
## 2021          34.51 28.93147 40.08853 25.97838 43.04162
## 2022          34.51 27.67773 41.34227 24.06094 44.95906
```

Variation: **Drift method**   
Change over time (=drift) is the **average change** in the historical data.

```
##      Point Forecast    Lo 80    Hi 80    Lo 95    Hi 95
## 2020       36.41143 32.82961 39.99325 30.93351 41.88935
## 2021       38.31286 32.64950 43.97621 29.65150 46.97421
## 2022       40.21429 32.61610 47.81248 28.59386 51.83471
```


---
#### Plotting the forecasts

![](NumbeoR_files/figure-html/unnamed-chunk-72-1.png)&lt;!-- --&gt;


---

#### Evaluating Forecast Accuracy

For the three methods Mean, Naïve Method and Drift Method the Accuracy can be deducted from comparison of forecasts 2017-2019 and real data.






![](NumbeoR_files/figure-html/unnamed-chunk-74-1.png)&lt;!-- --&gt;



---
class: center, middle
### Simple exponential smoothing

---
#### General

Exponential smoothing models:
* weighted averages of past observations  
* the older the (past) observation is the (exponentially) lower is the weigh

Simplest model is the **Simple Exponential Smoothing model (SES)**.  
It is suitable for forecasting data with no clear trend or seasonal pattern.

---

#### Flat forecasts
Simple exponential smoothing has a “flat” forecast  


```r
crimeGermanySes &lt;- window(crimeGermanyTS,start=2012,end=2019)
fc_ses &lt;- ses(crimeGermanySes, h=3)
fc_ses
```

```
##      Point Forecast    Lo 80    Hi 80    Lo 95    Hi 95
## 2020       34.51021 30.24954 38.77089 27.99407 41.02635
## 2021       34.51021 28.48501 40.53542 25.29546 43.72497
## 2022       34.51021 27.13100 41.88943 23.22468 45.79575
```

---
Optimazation of the model:

No trend and seasonal component assumed. As optimization criterion the Mean Squared Error (MSE) is chosen. 


```r
# Estimate parameters
fit_ets &lt;- tsibble_Germany %&gt;%
* model(ETS(Crime ~ error("A") + trend("N") + season("N"), opt_crit = "mse"))
fc_ets &lt;- fit_ets %&gt;%
  forecast(h = 3)

# Accuracy of one-step-ahead training errors
accuracy(fit_ets)
```

```
## # A tibble: 1 x 9
##   .model                   .type    ME  RMSE   MAE   MPE  MAPE  MASE   ACF1
##   &lt;chr&gt;                    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1 "ETS(Crime ~ error(\"A\~ Trai~  1.66  2.88  2.43  5.63  7.90 0.875 -0.623
```

---

![](NumbeoR_files/figure-html/unnamed-chunk-77-1.png)&lt;!-- --&gt;

In red the one-step-ahead fitted values plotted

---
Including an (additive) trend perspective will change the forecast.  
No seasonal component assumed. As optimization criterion the Mean Squared Error (MSE) is chosen. 

```r
# Estimate parameters
fit_ets2 &lt;- tsibble_Germany %&gt;%
* model(ETS(Crime ~ error("A") + trend("A") + season("N"), opt_crit = "mse"))
fc_ets2 &lt;- fit_ets2 %&gt;%
  forecast(h = 3)

# Accuracy of one-step-ahead training errors
accuracy(fit_ets2)
```

```
## # A tibble: 1 x 9
##   .model                .type      ME  RMSE   MAE    MPE  MAPE  MASE   ACF1
##   &lt;chr&gt;                 &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1 "ETS(Crime ~ error(\~ Trai~ -0.0132  1.45  1.21 -0.351  3.93 0.434 -0.429
```

---
#### Trend forecasts
![](NumbeoR_files/figure-html/unnamed-chunk-79-1.png)&lt;!-- --&gt;

---

### Autocorrelation  
Autocorrelation measures the linear relationship between lagged values of a time series.

![](NumbeoR_files/figure-html/unnamed-chunk-80-1.png)&lt;!-- --&gt;

The autocorrelations are the correlations associated with these scatter plots.
The highest positiv relationship is at lags 1 and 2.

---

The autocorrelations coefficients are displayed by the autocorrelation function ggAcf function  


![](NumbeoR_files/figure-html/unnamed-chunk-81-1.png)&lt;!-- --&gt;

---
class: middle
**Results of the Autocorrelation Analysis**

The dashed blue lines (±2/√T where T is the length of the time, in our case ±0,76) indicate whether the correlations are significantly different from zero.  

In our case no correlation is significant.  

Time series that show no autocorrelation are called *white noise*. 

---
class: center, middle

### Linear Model

---

Could there exist a linearity?

```r
tsibble_Germany %&gt;% select(Crime) %&gt;% 
  ggplot(aes(x=Year, y=Crime)) + ylab("Crime Index)") + xlab("Years") +
    geom_point() + geom_smooth(method="lm", se=FALSE)
```

![](NumbeoR_files/figure-html/unnamed-chunk-82-1.png)&lt;!-- --&gt;

---


```r
tsibble_Germany %&gt;%
  model(TSLM(Crime ~ Year)) %&gt;%
  report()
```

```
## Series: Crime 
## Model: TSLM 
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.4375 -0.8058 -0.2814  0.9629  2.2971 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -4199.3471   520.7726  -8.064 0.000195 ***
## Year            2.0982     0.2584   8.121 0.000187 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 1.675 on 6 degrees of freedom
## Multiple R-squared: 0.9166,	Adjusted R-squared: 0.9027
## F-statistic: 65.94 on 1 and 6 DF, p-value: 0.00018724
```

Constraints for our use case:
* In year 0 we certainly did not have a Crime Index of -4199
* Furtermore, an improvement of the crime index is possible and probable over a long period leading to a non-linearity
---
class: middle 
Now we will create a linear forecast.

First we train the model with TSLM() (time series linear model).


```r
fit_tslm &lt;- tsibble_Germany %&gt;%  model(trend_model = TSLM(Crime ~ trend()))
```


---
Assuming that the linear development will continue we plot the scenario funnel.

![](NumbeoR_files/figure-html/unnamed-chunk-85-1.png)&lt;!-- --&gt;

---
# Overall conclusion

**Results of the Hypothesis testing**

* The perceived crime rate correlates positively with the number of refugees.  
* This could lead to the conclusion that the refugees increase the real crime rate.   
* For our topic of observation (crime index in Germany) it is *not an issue of refugees* because the the real crime rate did not worsen.    
* We assume that the perception is caused by how this topic is handeled in the *media*.  
* Our advice to the respective decision-makers is to further analyse this specific assumption. 

**Results of the forecasting**  
* The application of pure *data-driven models* based on historical data is not appropriate to come to conclusions how the crime index will develop in future.   
* Furthermore *domain knowledge* is required to come to conclusions about the reasons for the past increase and how to improve the situation.  


---
class: center, middle
# Dashboarding in Shiny

---
## Data Export 
The complete master dataframe and clean dataframe is exported for further usage in Shiny dashboarding.

```r
pathForShiny1 &lt;- paste0(path,"daten/MasterDF.csv")
pathForShiny2 &lt;- paste0(path,"daten/CleanDF.csv")
write.csv(df_master_continent,pathForShiny1, row.names = FALSE)
write.csv(df_analysis_clean,pathForShiny2, row.names = FALSE)
```

---
class: center, middle
## Shiny App
Please open the [Shiny App](https://numbeo.shinyapps.io/NumbeoS/).
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
